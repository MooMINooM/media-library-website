<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏†‡∏π‡∏û‡∏£‡∏∞‡πÇ‡∏ô‡∏ô‡∏ú‡∏±‡∏Å‡∏´‡∏ß‡∏≤‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style> 
        body { font-family: 'Sarabun', sans-serif; } 
        .menu-item { @apply flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer transition text-gray-600 hover:bg-blue-50 hover:text-blue-600; }
        .menu-item.active { @apply bg-blue-600 text-white shadow-md hover:bg-blue-700 hover:text-white; }
        .input-box { @apply w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white; }
    </style>
</head>
<body class="bg-gray-100 h-screen flex overflow-hidden">

    <aside class="w-64 bg-white shadow-xl flex-shrink-0 flex flex-col z-20">
        <div class="p-6 border-b">
            <h1 class="font-bold text-xl text-blue-800">Admin Panel</h1>
            <p class="text-xs text-gray-500">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</p>
        </div>
        <nav class="flex-1 overflow-y-auto p-4 space-y-1">
            <div onclick="showSection('news')" class="menu-item active" id="menu-news"><i class="fa-regular fa-newspaper w-5"></i> ‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</div>
            
            <div class="pt-4 pb-1 text-xs font-bold text-gray-400 uppercase px-3">‡∏ú‡∏•‡∏á‡∏≤‡∏ô</div>
            <div onclick="showSection('teacher')" class="menu-item" id="menu-teacher"><i class="fa-solid fa-chalkboard-user w-5"></i> ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏π</div>
            <div onclick="showSection('student')" class="menu-item" id="menu-student"><i class="fa-solid fa-user-graduate w-5"></i> ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
            <div onclick="showSection('school')" class="menu-item" id="menu-school"><i class="fa-solid fa-school w-5"></i> ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)</div>

            <div class="pt-4 pb-1 text-xs font-bold text-gray-400 uppercase px-3">‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£ & ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</div>
            <div onclick="showSection('academic')" class="menu-item" id="menu-academic"><i class="fa-solid fa-chart-line w-5"></i> ‡∏ú‡∏•‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå (O-NET/NT/RT)</div>

            <div class="pt-4 pb-1 text-xs font-bold text-gray-400 uppercase px-3">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</div>
            <div onclick="showSection('document')" class="menu-item" id="menu-document"><i class="fa-solid fa-folder-open w-5"></i> ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ & ‡∏ü‡∏≠‡∏£‡πå‡∏°</div>
            <div onclick="showSection('innovation')" class="menu-item" id="menu-innovation"><i class="fa-solid fa-lightbulb w-5"></i> ‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°</div>
        </nav>
        <div class="p-4 border-t">
            <button onclick="logout()" class="w-full text-red-600 hover:bg-red-50 py-2 rounded-lg transition"><i class="fa-solid fa-sign-out-alt"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto p-8">
        
        <div id="section-news" class="content-section">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</h2>
            <div class="bg-white p-6 rounded-xl shadow-sm border mb-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="col-span-2"><label>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß</label><input type="text" id="news-title" class="input-box"></div>
                    <div><label>‡∏•‡∏¥‡∏á‡∏Å‡πå (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label><input type="text" id="news-link" class="input-box" placeholder="https://..."></div>
                    <div><label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label><input type="file" id="news-file" class="input-box"></div>
                </div>
                <button onclick="saveGeneric('news', ['title', 'link'], 'news-file')" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πà‡∏≤‡∏ß</button>
            </div>
            <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                <table class="w-full text-left text-sm" id="table-news"></table>
            </div>
        </div>

        <div id="section-achievement" class="content-section hidden">
            <h2 class="text-2xl font-bold mb-6 text-gray-800" id="ach-title">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏á‡∏≤‡∏ô</h2>
            <div class="bg-white p-6 rounded-xl shadow-sm border mb-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="col-span-2"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• / ‡∏ú‡∏•‡∏á‡∏≤‡∏ô</label><input type="text" id="ach-title-input" class="input-box"></div>
                    <div>
                        <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á (Competition)</label>
                        <input type="text" id="ach-comp" class="input-box" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏®‡∏¥‡∏•‡∏õ‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏£‡∏£‡∏° ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 71">
                        <p class="text-xs text-gray-400">‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö</p>
                    </div>
                    <div>
                        <label>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞</label>
                        <select id="ach-subject" class="input-box">
                            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                            <option value="‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                            <option value="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                            <option value="‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢">‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</option>
                            <option value="‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©">‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©</option>
                            <option value="‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                            <option value="‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û">‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</option>
                            <option value="‡∏®‡∏¥‡∏•‡∏õ‡∏∞">‡∏®‡∏¥‡∏•‡∏õ‡∏∞</option>
                            <option value="‡∏™‡∏∏‡∏Ç‡∏∞ - ‡∏û‡∏•‡∏∞">‡∏™‡∏∏‡∏Ç‡∏∞ - ‡∏û‡∏•‡∏∞</option>
                            <option value="‡∏õ‡∏ê‡∏°‡∏ß‡∏±‡∏¢">‡∏õ‡∏ê‡∏°‡∏ß‡∏±‡∏¢</option>
                        </select>
                    </div>
                    <div class="col-span-2"><label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ú‡∏•‡∏á‡∏≤‡∏ô</label><input type="text" id="ach-name" class="input-box"></div>
                    <div><label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label><input type="file" id="ach-file" class="input-box"></div>
                </div>
                <button onclick="saveAchievement()" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏á‡∏≤‡∏ô</button>
            </div>
            <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                <table class="w-full text-left text-sm" id="table-achievement"></table>
            </div>
        </div>

        <div id="section-academic" class="content-section hidden">
            <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center gap-3">
                ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏™‡∏±‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                <select id="academic-type" onchange="loadAcademicData()" class="text-base border-2 border-blue-500 text-blue-700 rounded-lg px-3 py-1 focus:outline-none bg-blue-50">
                    <option value="onet">O-NET</option>
                    <option value="nt">NT</option>
                    <option value="rt">RT</option>
                </select>
            </h2>

            <div class="bg-white p-6 rounded-xl shadow-sm border mb-6 border-l-4 border-blue-500">
                <h3 class="font-bold text-gray-700 mb-4" id="academic-form-header">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• O-NET</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</label>
                        <input type="text" id="acad-title" class="input-box" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö ‡∏õ‡∏µ 2566">
                    </div>
                    <div>
                        <label>‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (Tag)</label>
                        <input type="text" id="acad-tag" class="input-box" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2566 (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç! ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå)">
                    </div>
                    <div class="col-span-2">
                        <label>‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (PDF ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û)</label>
                        <input type="file" id="acad-file" class="input-box">
                    </div>
                </div>
                <button onclick="saveAcademic()" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 w-full md:w-auto">
                    <i class="fa-solid fa-cloud-arrow-up"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>

            <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                <table class="w-full text-left text-sm">
                    <thead class="bg-gray-50 border-b">
                        <tr><th class="p-3">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th class="p-3">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</th><th class="p-3">‡∏õ‡∏µ (Tag)</th><th class="p-3">‡πÑ‡∏ü‡∏•‡πå</th><th class="p-3">‡∏•‡∏ö</th></tr>
                    </thead>
                    <tbody id="table-academic"></tbody>
                </table>
            </div>
        </div>

        <div id="section-document" class="content-section hidden">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h2>
            <div class="bg-white p-6 rounded-xl shadow-sm border mb-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="col-span-2"><label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</label><input type="text" id="doc-title" class="input-box"></div>
                    <div>
                        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                        <select id="doc-category" class="input-box">
                            <option value="‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£">‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£</option>
                            <option value="‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•">‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</option>
                            <option value="‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì">‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</option>
                            <option value="‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                        </select>
                    </div>
                    <div><label>‡πÑ‡∏ü‡∏•‡πå (PDF/Word)</label><input type="file" id="doc-file" class="input-box"></div>
                </div>
                <button onclick="saveGeneric('documents', ['title', 'category'], 'doc-file')" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</button>
            </div>
            <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                <table class="w-full text-left text-sm" id="table-documents"></table>
            </div>
        </div>

        <div id="section-innovation" class="content-section hidden">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°</h2>
            <div class="bg-white p-6 rounded-xl shadow-sm border mb-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="col-span-2"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°</label><input type="text" id="inno-title" class="input-box"></div>
                    <div><label>‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ú‡∏•‡∏á‡∏≤‡∏ô</label><input type="text" id="inno-creator" class="input-box"></div>
                    <div><label>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞</label><input type="text" id="inno-subject" class="input-box"></div>
                    <div><label>‡∏£‡∏π‡∏õ‡∏õ‡∏Å</label><input type="file" id="inno-cover" class="input-box"></div>
                    <div><label>‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏•‡∏á‡∏≤‡∏ô (PDF/Link)</label><input type="text" id="inno-link" class="input-box" placeholder="Link ‡∏´‡∏£‡∏∑‡∏≠ URL"></div>
                </div>
                <button onclick="saveInnovation()" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°</button>
            </div>
            <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                <table class="w-full text-left text-sm" id="table-innovations"></table>
            </div>
        </div>

    </main>

    <script>
        // ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Supabase ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è
        const PROJECT_URL = 'https://dazypxnsfwdwrqluicbc.supabase.co'; 
        const ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRhenlweG5zZndkd3JxbHVpY2JjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxNDkzMDIsImV4cCI6MjA4MjcyNTMwMn0.hAxjy_poDer5ywgRAZwzTkXF-OAcpduLxESW3v5adxo';
        const supabase = window.supabase.createClient(PROJECT_URL, ANON_KEY);

        // State
        let currentAchType = 'teacher'; 

        // 1. Check Login
        async function checkAuth() {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) window.location.href = 'index.html';
            else showSection('news'); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡πà‡∏≤‡∏ß
        }

        // 2. Navigation
        window.showSection = function(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));

            // Show selected
            let targetId = sectionId;
            if(['teacher', 'student', 'school'].includes(sectionId)) targetId = 'achievement'; // ‡∏£‡∏ß‡∏° 3 ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏ô‡πâ‡∏≤ achievement ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô

            document.getElementById(`section-${targetId}`).classList.remove('hidden');
            document.getElementById(`menu-${sectionId}`).classList.add('active');

            // Load Data based on section
            if(sectionId === 'news') loadGenericTable('news', 'table-news');
            else if(sectionId === 'document') loadGenericTable('documents', 'table-documents');
            else if(sectionId === 'innovation') loadGenericTable('innovations', 'table-innovations');
            else if(sectionId === 'academic') loadAcademicData(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£
            else {
                // Achievement Types
                currentAchType = sectionId; // teacher, student, school
                document.getElementById('ach-title').innerText = `‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏á‡∏≤‡∏ô${sectionId === 'teacher' ? '‡∏Ñ‡∏£‡∏π' : sectionId === 'student' ? '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô' : '‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'}`;
                loadAchievementTable();
            }
        }

        // --------------------------------------------------------
        // üè´ ACADEMIC LOGIC (O-NET / NT / RT) - ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà
        // --------------------------------------------------------
        
        async function loadAcademicData() {
            const type = document.getElementById('academic-type').value; // onet, nt, rt
            document.getElementById('academic-form-header').innerText = `‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${type.toUpperCase()}`;
            
            const tbody = document.getElementById('table-academic');
            tbody.innerHTML = '<tr><td colspan="5" class="p-4 text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>';

            const { data, error } = await supabase.from(type).select('*').order('id', { ascending: false });
            if(error) { console.error(error); return; }

            tbody.innerHTML = '';
            if(data.length === 0) tbody.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';

            data.forEach(item => {
                tbody.innerHTML += `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-3">${new Date(item.date).toLocaleDateString('th-TH')}</td>
                        <td class="p-3 font-bold">${item.title}</td>
                        <td class="p-3"><span class="bg-blue-100 text-blue-800 px-2 rounded text-xs">${item.tag}</span></td>
                        <td class="p-3"><a href="${item.file_url}" target="_blank" class="text-blue-600 hover:underline">‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå</a></td>
                        <td class="p-3"><button onclick="deleteItem('${type}', ${item.id}, loadAcademicData)" class="text-red-500"><i class="fa-solid fa-trash"></i></button></td>
                    </tr>
                `;
            });
        }

        window.saveAcademic = async function() {
            const type = document.getElementById('academic-type').value;
            const title = document.getElementById('acad-title').value;
            const tag = document.getElementById('acad-tag').value;
            const file = document.getElementById('acad-file').files[0];

            if(!title || !tag || !file) { Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö', 'warning'); return; }

            Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...', didOpen: () => Swal.showLoading() });
            
            // Upload
            const fileName = `academic/${type}/${Date.now()}_${file.name}`;
            const { error: uploadError } = await supabase.storage.from('uploads').upload(fileName, file); // ‡πÉ‡∏ä‡πâ Bucket 'uploads' ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô
            if(uploadError) { Swal.fire('Error', uploadError.message, 'error'); return; }
            
            const { data: { publicUrl } } = supabase.storage.from('uploads').getPublicUrl(fileName);

            // Insert
            const { error } = await supabase.from(type).insert([{
                title: title,
                tag: tag,
                file_url: publicUrl,
                date: new Date()
            }]);

            if(error) Swal.fire('Error', error.message, 'error');
            else {
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                document.getElementById('acad-title').value = '';
                document.getElementById('acad-tag').value = '';
                document.getElementById('acad-file').value = '';
                loadAcademicData();
            }
        }

        // --------------------------------------------------------
        // üèÜ ACHIEVEMENT LOGIC (Teacher/Student/School)
        // --------------------------------------------------------
        async function loadAchievementTable() {
            const table = `${currentAchType}_achievements`;
            const tbody = document.getElementById('table-achievement');
            tbody.innerHTML = '<tr><td class="p-4 text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>';
            
            const { data } = await supabase.from(table).select('*').order('id', { ascending: false });
            tbody.innerHTML = '';
            
            data.forEach((item, index) => {
                tbody.innerHTML += `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-3">${index+1}</td>
                        <td class="p-3"><img src="${item.image}" class="w-10 h-10 object-cover rounded"></td>
                        <td class="p-3 font-bold">${item.title || item.name}</td>
                        <td class="p-3 text-xs text-gray-500">${item.competition || '-'}</td>
                        <td class="p-3"><button onclick="deleteItem('${table}', ${item.id}, loadAchievementTable)" class="text-red-500"><i class="fa-solid fa-trash"></i></button></td>
                    </tr>`;
            });
        }

        window.saveAchievement = async function() {
            const table = `${currentAchType}_achievements`;
            const title = document.getElementById('ach-title-input').value;
            const comp = document.getElementById('ach-comp').value;
            const subj = document.getElementById('ach-subject').value;
            const name = document.getElementById('ach-name').value;
            const file = document.getElementById('ach-file').files[0];

            if(!title || !file) { Swal.fire('‡∏Ç‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ', 'warning'); return; }

            Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...', didOpen: () => Swal.showLoading() });
            
            // Upload
            const fileName = `achievements/${Date.now()}_${file.name}`;
            const { error: upErr } = await supabase.storage.from('uploads').upload(fileName, file);
            if(upErr) { Swal.fire('Error', upErr.message, 'error'); return; }
            const { data: { publicUrl } } = supabase.storage.from('uploads').getPublicUrl(fileName);

            // Insert
            const payload = { 
                title: title, 
                competition: comp, 
                subject: subj, 
                image: publicUrl, 
                date: new Date() 
            };
            if(currentAchType === 'teacher') payload.name = name;
            else if(currentAchType === 'student') payload.students = name;
            // school ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ name

            const { error } = await supabase.from(table).insert([payload]);
            if(error) Swal.fire('Error', error.message, 'error');
            else {
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                // Clear Form (Simplified)
                document.getElementById('ach-title-input').value = '';
                document.getElementById('ach-file').value = '';
                loadAchievementTable();
            }
        }

        // --------------------------------------------------------
        // üì∞ GENERIC LOGIC (News / Docs / Innovation)
        // --------------------------------------------------------
        async function loadGenericTable(table, tableId) {
            const tbody = document.getElementById(tableId);
            tbody.innerHTML = '<tr><td class="p-4 text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>';
            const { data } = await supabase.from(table).select('*').order('id', { ascending: false });
            tbody.innerHTML = '';
            
            data.forEach((item, index) => {
                let imgHtml = item.image ? `<img src="${item.image}" class="w-10 h-10 object-cover rounded">` : (item.fileUrl ? '<i class="fa-solid fa-file text-blue-500"></i>' : '-');
                tbody.innerHTML += `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-3">${index+1}</td>
                        <td class="p-3">${imgHtml}</td>
                        <td class="p-3 font-bold">${item.title}</td>
                        <td class="p-3"><button onclick="deleteItem('${table}', ${item.id}, () => loadGenericTable('${table}', '${tableId}'))" class="text-red-500"><i class="fa-solid fa-trash"></i></button></td>
                    </tr>`;
            });
        }

        window.saveGeneric = async function(table, fields, fileInputId) {
            // ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            // ‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏Ñ‡∏ß‡∏£‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏° fields ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤
            const file = document.getElementById(fileInputId).files[0];
            let publicUrl = '';
            
            if(file) {
                Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...', didOpen: () => Swal.showLoading() });
                const fileName = `${table}/${Date.now()}_${file.name}`;
                await supabase.storage.from('uploads').upload(fileName, file);
                publicUrl = supabase.storage.from('uploads').getPublicUrl(fileName).data.publicUrl;
            }

            let payload = { date: new Date() };
            if(table === 'news') {
                payload.title = document.getElementById('news-title').value;
                payload.link = document.getElementById('news-link').value;
                payload.image = publicUrl;
            } else if (table === 'documents') {
                payload.title = document.getElementById('doc-title').value;
                payload.category = document.getElementById('doc-category').value;
                payload.fileUrl = publicUrl;
                payload.uploadDate = new Date();
            } else if (table === 'innovations') {
                payload.title = document.getElementById('inno-title').value;
                payload.creator = document.getElementById('inno-creator').value;
                payload.subject = document.getElementById('inno-subject').value;
                payload.fileUrl = document.getElementById('inno-link').value;
                payload.coverImageUrl = document.getElementById('inno-cover').files[0] ? (await uploadFile(document.getElementById('inno-cover').files[0])) : '';
                // *‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: Innovation ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏¢‡∏Å‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡∏≠‡∏±‡∏õ 2 ‡πÑ‡∏ü‡∏•‡πå
            }

            await supabase.from(table).insert([payload]);
            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            loadGenericTable(table, `table-${table}`);
        }
        
        async function uploadFile(file) {
             const fileName = `misc/${Date.now()}_${file.name}`;
             await supabase.storage.from('uploads').upload(fileName, file);
             return supabase.storage.from('uploads').getPublicUrl(fileName).data.publicUrl;
        }

        // --------------------------------------------------------
        // üóëÔ∏è COMMON UTILS
        // --------------------------------------------------------
        window.deleteItem = async function(table, id, refreshCallback) {
            const result = await Swal.fire({ title: '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•?', icon: 'warning', showCancelButton: true, confirmButtonText: '‡∏•‡∏ö‡πÄ‡∏•‡∏¢' });
            if (result.isConfirmed) {
                await supabase.from(table).delete().eq('id', id);
                refreshCallback();
                Swal.fire('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß', '', 'success');
            }
        }

        window.logout = async () => { await supabase.auth.signOut(); window.location.href = 'index.html'; }

        checkAuth();
    </script>
</body>
</html>
